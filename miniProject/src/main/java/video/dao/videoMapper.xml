<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="videoSQL">

	<!--비디오 -->
	<select id="getVideoById" parameterType="java.util.Map" resultType="video.bean.VideoDTO">
		SELECT Video.*,
		(SELECT COUNT(*) FROM Like_count WHERE video_id = Video.video_id) AS video_like_count,
		Comment.comment_text,
		(SELECT COUNT(*) FROM Like_count WHERE comment_id = Comment.comment_id) AS comment_like_count,
		Channel.channel_name,
		(SELECT COUNT(*) FROM Subscription WHERE channel_id = Channel.channel_id) AS subscriber_count,
		CASE WHEN EXISTS (SELECT * FROM Subscription WHERE user_id = #{user_id} AND channel_id = Channel.channel_id) THEN 1 ELSE 0 END AS is_subscribed
		FROM Video
		LEFT JOIN Comment ON Video.video_id = Comment.video_id
		LEFT JOIN Channel ON Video.channel_id = Channel.channel_id
		WHERE Video.video_id = #{video_id};

	</select>

</mapper>